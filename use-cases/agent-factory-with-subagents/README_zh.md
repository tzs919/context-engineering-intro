# 🏭 基于 Claude Code 子智能体的 AI 智能体工厂

一个强大而简单的编排框架，利用 Claude Code 的子智能体能力自主构建使用 Pydantic AI 的 AI 智能体。该系统通过一系列专门的子智能体协同工作流，将基本需求转变为功能完整、经过测试且文档完善的 AI 智能体。传统上需要数小时或数天的开发工作，现在只需几分钟即可完成。

> **完整示例**：要查看使用此框架构建的完整可运行 AI 智能体，请参阅 [混合搜索 RAG 智能体](agents/rag_agent)，其中包含完整的设置说明和文档。

## 🚦 快速开始

1. **请求一个智能体**：在此目录中打开 Claude Code 并请求构建一个 AI 智能体（参见下面的示例，你的提示可以很简单）
2. **回答澄清问题**：提供 2-3 个关于你需求的简短答案
3. **观看魔法**：子智能体并行工作，在 `agents/` 下的新文件夹中构建你的智能体
4. **接收你的智能体**：包含测试、文档和设置说明的完整智能体

## 🎯 为什么使用子智能体？

Claude Code 子智能体一直备受关注，这是有充分理由的。通过子智能体，我们可以获得：

### **并行执行与可扩展性**
- 同时运行多个专门的智能体，大幅减少开发时间
- 每个子智能体独立运行，拥有自己的上下文窗口
- 编排复杂的工作流，无需担心上下文污染或 token 限制

### **专门的系统提示**
- 每个子智能体都有专注的、针对任务优化的提示
- 防止提示稀释，在不同任务中保持专业知识
- 在不影响通用能力的情况下实现深入的领域知识

### **模块化架构**
- 关注点清晰分离，具有独立的配置和工具
- 可重用的组件，可以在项目间进行版本控制和共享
- 易于扩展、修改或替换单个子智能体，而不影响其他部分

## 🏗️ 子智能体工作流架构

```
┌─────────────────┐
│  用户请求        │
└────────┬────────┘
         ▼
┌─────────────────────┐
│ 阶段 0: 澄清需求     │
└────────┬────────────┘
         ▼
┌─────────────────────┐
│ 阶段 1: 规划器       │
└────────┬────────────┘
         ▼
┌─────────────────────────────────────┐
│     阶段 2: 并行开发                 │
│  ┌─────────────┬─────────────┬──────┴───────┐
│  │   提示词     │    工具     │  依赖项       │
│  │   工程师     │  集成器     │   管理器      │
│  └─────────────┴─────────────┴──────────────┘
└────────┬────────────────────────────┘
         ▼
┌─────────────────────┐
│ 阶段 3: 实现         │
└────────┬────────────┘
         ▼
┌─────────────────────┐
│ 阶段 4: 验证器       │
└────────┬────────────┘
         ▼
┌─────────────────────┐
│ 阶段 5: 交付         │
└─────────────────────┘
```

### AI 智能体工厂的工作流阶段

1. **阶段 0：澄清需求** - 主智能体提出针对性问题以了解需求
2. **阶段 1：需求文档** - 规划器子智能体创建全面的规范
3. **阶段 2：并行组件开发** - 三个专门的子智能体同时工作：
   - **提示词工程师**：设计最优系统提示
   - **工具集成器**：规划工具实现和 API 集成
   - **依赖项管理器**：配置环境和依赖项
4. **阶段 3：实现** - 主智能体使用规范构建完整的智能体
5. **阶段 4：验证** - 验证器子智能体创建测试并验证功能
6. **阶段 5：交付** - 文档和最终打包

## 📁 项目结构

```
.
├── CLAUDE.md                    # 中央编排规则和工作流
├── agents/                      # 生成的 AI 智能体
│   ├── rag_agent/               # 示例：完整的 RAG 智能体实现
│   └── your_agent_here/         # 工厂创建的智能体会放在这里
├── examples/                    # Pydantic AI 模式和参考
│   ├── main_agent_reference/    # 参考实现模式
│   └── rag_pipeline/            # RAG 基础设施组件
│   CLAUDE.md                    # 指导 Claude Code 执行 AI 智能体工厂工作流的全局规则
└── README.md                    # 本文件
```

## 🤖 子智能体

### **pydantic-ai-planner**
创建最小化、聚焦的需求文档（INITIAL.md），采用 MVP 思维。分析用户需求并为智能体开发生成清晰的规范。

### **pydantic-ai-prompt-engineer**
设计简洁的系统提示（100-300 字），定义智能体行为。专注于为 Pydantic AI 智能体创建清晰、有效的提示。

### **pydantic-ai-tool-integrator**
规划工具规范，聚焦于 2-3 个基本功能。定义工具参数、错误处理和集成模式。

### **pydantic-ai-dependency-manager**
配置最小依赖项和环境变量。设置模型提供商、数据库连接和智能体初始化。

### **pydantic-ai-validator**
使用 TestModel 和 FunctionModel 创建全面的测试套件。验证需求，测试功能，并确保生产就绪。

## 🎨 CLAUDE.md - 编排引擎

`CLAUDE.md` 文件是系统的核心，包含：

- **工作流触发器**：激活智能体工厂的模式
- **阶段定义**：每个开发阶段的详细说明
- **子智能体提示**：每个子智能体的专门指令
- **质量门禁**：每个阶段的验证标准
- **集成规则**：组件如何协同工作

主要特性：
- 从用户请求自动识别工作流
- 并行子智能体调用以获得最佳性能
- Archon 集成用于项目管理（可选）
- 全面的错误处理和恢复

## 🚀 示例提示

### 简单智能体
```
"构建一个可以搜索网页的 AI 智能体"
"创建一个用于总结文档的智能体"
"我需要一个可以查询数据库的助手"
```

### 复杂智能体
```
"构建一个客户支持智能体，集成 Slack 并搜索我们的知识库"
"创建一个数据分析智能体，可以查询 PostgreSQL 并生成可视化"
"实现一个内容生成智能体，具有品牌语音定制和 SEO 优化功能"
```

### 领域特定智能体
```
"构建一个可以处理财报的财务分析智能体"
"创建一个遵循团队风格指南的代码审查智能体"
"实现一个可以搜索学术论文并总结发现的研究智能体"
```

## 🔗 可选的 Archon 集成

当 [Archon](https://archon.diy) 通过 MCP 可用时，系统提供增强的项目管理：

- **自动项目创建**，带有任务跟踪
- **状态更新**，随着每个阶段的进展
- **RAG 驱动的研究**，在实现期间
- **持久化项目历史**，用于迭代和改进

Archon 集成是可选的——即使没有它，系统也能完美工作，使用本地 TodoWrite 进行任务跟踪。

## 💡 主要优势

### **速度**
- 10-15 分钟完成完整智能体 vs 数小时的手动开发
- 并行处理减少顺序瓶颈
- 包含自动化测试和验证

### **质量**
- 遵循最佳实践的一致架构
- 80%+ 覆盖率的全面测试
- 生产就绪，具有错误处理和日志记录

### **灵活性**
- 支持任何 LLM 提供商（OpenAI、Anthropic、Gemini、Ollama）
- 支持各种数据库（PostgreSQL、SQLite、Redis）
- 可扩展以满足自定义需求

### **可维护性**
- 清晰的关注点分离
- 文档完善的代码和 API
- 可重用的组件和模式

## 📚 Pydantic AI 集成

所有智能体都使用 [Pydantic AI](https://ai.pydantic.dev/) 构建，提供：

- **类型安全**：完整的类型提示和运行时验证
- **结构化输出**：可靠的、模式验证的响应
- **依赖注入**：清晰的关注点分离
- **测试支持**：TestModel 和 FunctionModel 用于全面测试
- **多提供商**：支持 OpenAI、Anthropic、Gemini 等

## 🛠️ 组件说明

### 规划文档
每个智能体包含四个规划文档：
- `INITIAL.md` - 需求和规范
- `prompts.md` - 系统提示设计
- `tools.md` - 工具规范
- `dependencies.md` - 配置和依赖项

### 实现文件
- `agent.py` - 主智能体逻辑
- `tools.py` - 工具实现
- `settings.py` - 环境配置
- `providers.py` - LLM 提供商
- `dependencies.py` - 依赖注入
- `cli.py` - 命令行界面

### 测试与验证
- 使用 pytest 的全面测试套件
- TestModel 用于开发测试
- FunctionModel 用于行为验证
- 集成测试用于端到端验证

系统处理从需求分析到实现、测试和文档编写的所有其他工作。

## 🔮 未来增强

- 针对特定领域的额外专门子智能体
- 增强的常见用例模式库
- 自动化部署流水线生成
- 跨智能体通信协议
- 实时协作功能